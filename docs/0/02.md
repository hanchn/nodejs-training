# Node.js 的三个阶段

## 写得跑 / 跑得稳 / 跑得省

> 很多 Node 项目不是“技术不行”，而是**停在了错误的阶段**。

---

## 一、阶段一：**写得跑**（能上线就行）

### 1️⃣ 这个阶段在解决什么？

> **“需求先跑起来”**

这是绝大多数项目的起点：

* 业务验证期
* MVP
* 临时项目 / 赶大促

---

### 2️⃣ 典型特征

| 维度 | 表现                      |
| -- | ----------------------- |
| 代码 | 能跑就行，逻辑堆一起              |
| 架构 | 单体服务                    |
| 并发 | 没概念                     |
| 错误 | try/catch + console.log |
| 性能 | 不测                      |
| 发布 | 手动发                     |

```js
app.get('/api', async (req, res) => {
  const a = await fetchA()
  const b = await fetchB()
  res.json({ a, b })
})
```

👉 **功能没问题，风险全在后面**

---

### 3️⃣ 这一阶段最容易踩的坑

* 同步阻塞代码混进来
* SSR / API / 任务全写一个进程
* 没有超时 / 重试
* 一个接口慢，整体跟着慢

---

### 4️⃣ 判断你是否还停在「写得跑」

* ❓ QPS 多大你不知道
* ❓ CPU 高了只能“多加机器”
* ❓ 线上慢了靠感觉

> **如果是，那说明项目还没毕业**

---

## 二、阶段二：**跑得稳**（大促不炸）

### 1️⃣ 这个阶段在解决什么？

> **“流量上来，系统不能崩”**

这是 Node 真正的**分水岭**。

---

### 2️⃣ 阶段核心认知升级

| 旧认知     | 新认知   |
| ------- | ----- |
| 代码写完就行  | 稳定性优先 |
| 报错再修    | 事前防御  |
| 加机器解决一切 | 先看瓶颈  |

---

### 3️⃣ 技术特征（Node 必须做到）

#### ✅ 1. 并发与事件循环意识

* 明确：**CPU 才是 Node 的上限**
* 监控：

  * event loop delay
  * CPU / 内存
  * GC 次数

---

#### ✅ 2. 稳定性机制齐全

* 超时控制（每一层）
* 接口重试（有边界）
* 限流 / 熔断 / 降级
* 兜底页面 / 兜底数据

```js
await withTimeout(fetchAPI(), 300)
```

---

#### ✅ 3. 服务职责拆分

```text
首页 SSR
列表 SSR
PDP SSR
API 聚合
```

* 重计算从 Node 主服务移走
* 不同流量模型独立扩容

---

### 4️⃣ 这一阶段的典型能力

* 大促扛得住
* 爬虫流量不拖垮
* 故障可快速定位

---

### 5️⃣ 判断你是否进入「跑得稳」

* ✔ 知道单机极限
* ✔ 能说清瓶颈在哪
* ✔ 有兜底方案

---

## 三、阶段三：**跑得省**（同样流量，机器更少）

### 1️⃣ 这个阶段在解决什么？

> **“系统已经稳了，开始算账”**

这是**架构成熟期**，也是技术负责人真正拉开差距的地方。

---

### 2️⃣ 核心关注点变化

| 从    | 到     |
| ---- | ----- |
| 能扛   | 扛得值不值 |
| 多加机器 | 精细化优化 |
| 粗放扩容 | 成本模型  |

---

### 3️⃣ 技术手段（Node 进阶）

#### ✅ 1. QPS / 成本模型化

* 单机 QPS
* 单请求 CPU 时间
* 每 1% 性能 ≈ 多少机器

---

#### ✅ 2. 精细化拆分与复用

* Layout 抽离
* SSR + CSR 混合
* 页面级流量分布建模

---

#### ✅ 3. Edge / CDN / 非 Node 化

* 能不进 Node 就不进
* 静态、半静态前移
* Bot / SEO / 人流分流

---

### 4️⃣ 跑得省阶段的典型表现

* 流量翻倍，机器不翻倍
* 大促成本可预估
* 技术方案能“解释 ROI”

---

### 5️⃣ 判断你是否到「跑得省」

* ✔ 能算出多一台机器值不值
* ✔ 知道哪些流量不该进 Node
* ✔ 技术决策有财务语言

---

## 四、三阶段对照总表（可直接贴 PPT）

| 阶段  | 核心目标 | 关键词 | 技术负责人关注点 |
| --- | ---- | --- | -------- |
| 写得跑 | 能上线  | 快   | 功能完整     |
| 跑得稳 | 不炸   | 稳   | 风险控制     |
| 跑得省 | 性价比  | 优   | 成本结构     |

---

## 五、一句非常重要的话（给团队）

> **写得跑是能力，跑得稳是责任，跑得省是格局**

---

